From 6e7f311ceb8d7527f6484119108e4424bd834831 Mon Sep 17 00:00:00 2001
From: Luffbee <luffbee@outlook.com>
Date: Sun, 11 Aug 2019 01:44:34 +0800
Subject: [PATCH] fix issue#205 (#206)

---
 prost-derive/src/lib.rs       |  2 +-
 tests/src/message_encoding.rs | 24 ++++++++++++++++++++++++
 2 files changed, 25 insertions(+), 1 deletion(-)

diff --git a/prost-derive/src/lib.rs b/prost-derive/src/lib.rs
index 6fe97aa..6f1b4c0 100644
--- a/prost-derive/src/lib.rs
+++ b/prost-derive/src/lib.rs
@@ -52,7 +52,7 @@ fn try_message(input: TokenStream) -> Result<TokenStream, Error> {
         } => Vec::new(),
     };
 
-    let mut next_tag: u32 = 0;
+    let mut next_tag: u32 = 1;
     let mut fields = fields
         .into_iter()
         .enumerate()
diff --git a/tests/src/message_encoding.rs b/tests/src/message_encoding.rs
index 59bf087..2ee8c94 100644
--- a/tests/src/message_encoding.rs
+++ b/tests/src/message_encoding.rs
@@ -193,6 +193,30 @@ pub struct ScalarTypes {
 fn check_tags_inferred() {
     check_message(&TagsInferred::default());
     check_serialize_equivalent(&TagsInferred::default(), &TagsQualified::default());
+
+    let tags_inferred = TagsInferred {
+        one: true,
+        two: Some(42),
+        three: vec![0.0, 1.0, 1.0],
+        skip_to_nine: "nine".to_owned(),
+        ten: 0,
+        eleven: ::std::collections::HashMap::new(),
+        back_to_five: vec![1, 0, 1],
+        six: Basic::default(),
+    };
+    check_message(&tags_inferred);
+
+    let tags_qualified = TagsQualified {
+        one: true,
+        two: Some(42),
+        three: vec![0.0, 1.0, 1.0],
+        five: vec![1, 0, 1],
+        six: Basic::default(),
+        nine: "nine".to_owned(),
+        ten: 0,
+        eleven: ::std::collections::HashMap::new(),
+    };
+    check_serialize_equivalent(&tags_inferred, &tags_qualified);
 }
 
 #[derive(Clone, PartialEq, Message)]
-- 
2.25.1

