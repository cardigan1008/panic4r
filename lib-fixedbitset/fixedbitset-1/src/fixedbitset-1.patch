From 3b5a51e52352982617517423de077dda47fa3bd5 Mon Sep 17 00:00:00 2001
From: Ophir LOJKINE <ophir.lojkine@auto-grid.com>
Date: Mon, 17 Aug 2020 18:14:25 +0200
Subject: [PATCH] add useful error messages to assertions (#52)

* add useful error messages to assertions

Fixes #51
---
 src/lib.rs | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

diff --git a/src/lib.rs b/src/lib.rs
index 5ad52d3..3c50efe 100644
--- a/src/lib.rs
+++ b/src/lib.rs
@@ -143,7 +143,7 @@ impl FixedBitSet
     #[inline]
     pub fn insert(&mut self, bit: usize)
     {
-        assert!(bit < self.length);
+        assert!(bit < self.length, "insert at index {} exceeds fixbitset size {}", bit, self.length);
         let (block, i) = div_rem(bit, BITS);
         unsafe {
             *self.data.get_unchecked_mut(block) |= 1 << i;
@@ -156,7 +156,7 @@ impl FixedBitSet
     #[inline]
     pub fn put(&mut self, bit: usize) -> bool
     {
-        assert!(bit < self.length);
+        assert!(bit < self.length, "put at index {} exceeds fixbitset size {}", bit, self.length);
         let (block, i) = div_rem(bit, BITS);
         unsafe {
             let word = self.data.get_unchecked_mut(block);
@@ -170,7 +170,7 @@ impl FixedBitSet
     /// ***Panics*** if **bit** is out of bounds
     #[inline]
     pub fn toggle(&mut self, bit: usize) {
-        assert!(bit < self.length);
+        assert!(bit < self.length, "toggle at index {} exceeds fixbitset size {}", bit, self.length);
         let (block, i) = div_rem(bit, BITS);
         unsafe {
             *self.data.get_unchecked_mut(block) ^= 1 << i;
@@ -180,7 +180,7 @@ impl FixedBitSet
     #[inline]
     pub fn set(&mut self, bit: usize, enabled: bool)
     {
-        assert!(bit < self.length);
+        assert!(bit < self.length, "set at index {} exceeds fixbitset size {}", bit, self.length);
         let (block, i) = div_rem(bit, BITS);
         unsafe {
             let elt = self.data.get_unchecked_mut(block);
@@ -198,7 +198,7 @@ impl FixedBitSet
     #[inline]
     pub fn copy_bit(&mut self, from: usize, to: usize)
     {
-        assert!(to < self.length);
+        assert!(to < self.length, "copy at index {} exceeds fixbitset size {}", to, self.length);
         let (to_block, t) = div_rem(to, BITS);
         let enabled = self.contains(from);
         unsafe {
@@ -539,7 +539,8 @@ impl Masks {
     fn new<T: IndexRange>(range: T, length: usize) -> Masks {
         let start = range.start().unwrap_or(0);
         let end = range.end().unwrap_or(length);
-        assert!(start <= end && end <= length);
+        assert!(start <= end && end <= length,
+            "invalid range {}..{} for a fixedbitset of size {}", start, end, length);
 
         let (first_block, first_rem) = div_rem(start, BITS);
         let (last_block, last_rem) = div_rem(end, BITS);
-- 
2.25.1

